<!DOCTYPE html>
<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">

    <!-- External packages -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0/dist/tf.min.js"></script>

    <!-- Internal packages -->
    <script src="./utils/display.js"></script>
    <script src="./main.js"></script>
    <link rel="stylesheet" href="./utils/display.css">
</head>

<body>
    <div class="center">
        <h1> SDSS Galaxy Similarity Search </h1>
        <p>Search for similar galaxies in the Solan Digital Sky Survey.
            Provide either the coordinates of your galaxy using ra/dec or click
            on one of the example images below.</p>

        <img width="128" height="128" onclick="changeFormValueAndSubmit(178.908, -0.771)"
            src="http://skyserver.sdss.org/dr16/SkyServerWS/ImgCutout/getjpeg?TaskName=Skyserver.Explore.Image&ra=178.908&dec=-0.771&width=256&height=256" />
        <img width="128" height="128" onclick="changeFormValueAndSubmit(256.157, 60.585)"
            src="http://skyserver.sdss.org/dr16/SkyServerWS/ImgCutout/getjpeg?TaskName=Skyserver.Explore.Image&ra=256.157&dec=60.585&width=256&height=256" />
        <img width="128" height="128" onclick="changeFormValueAndSubmit(229.525575754, 42.745853761)"
            src="http://skyserver.sdss.org/dr16/SkyServerWS/ImgCutout/getjpeg?TaskName=Skyserver.Explore.Image&ra=229.525575754&dec=42.745853761&width=256&height=256" />
        <img width="128" height="128" onclick="changeFormValueAndSubmit(173.49774, -3.60639)"
            src="http://skyserver.sdss.org/dr16/SkyServerWS/ImgCutout/getjpeg?TaskName=Skyserver.Explore.Image&ra=173.49774&dec=-3.60639&width=256&height=256" />
        <form id="frm1">
            ra: <input type="text" name="ra" id="ra" value="229.525575753922"><br>
            dec: <input type="text" name="dec" id="dec" value="42.7458537608544"><br><br>
            <input id="submit_button" type="button" onclick="main()" value="Submit">
        </form>
        <br>
        <img id="my_image" width="128" height="128" style="display:none" src="http://skyserver.sdss.org/dr16/SkyServerWS/ImgCutout/getjpeg?TaskName=Skyserver.Explore.Image&ra=173.49774&dec=-3.60639&width=256&height=256"/>
        <div id="imagecontainer"></div>
        <div class='widget'></div>
    </div>
    <div class="footer"> Made by <a href="https://kyuseokoh.work/"> Kyuseok Oh </a> & M. Dennis Turp </div>

</body>

<script>

    let chart = radialProgress('.widget')


    function get_form_data() {
        let ra = document.getElementById("ra").value
        let dec = document.getElementById("dec").value
        return { "ra": ra, "dec": dec }
    }



    async function main() {

        var form_data = get_form_data()
        const example = await predictImage(form_data.ra, form_data.dec)
        const ids = await d3.json(base_address + `ids_ra_dec.json`).then(data => {
            return data
        })
        const scores = await compute_scores(example)

        const sorted_indexs = arg_sort(scores)
        const top_ten_galaxies = sorted_indexs.slice(0, 10).map(idx => ids[idx])

        console.log(top_ten_galaxies)
        appendImages(top_ten_galaxies, "imagecontainer")
    }

</script>

</html>